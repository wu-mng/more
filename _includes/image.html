{% capture default_image %} 
  {{ site.defaults[0].values.image.path }} 
{% endcapture %}

{% capture width %}
  {% case include.size %}
    {% when "thumb" %}
      {{ site.data.responsives.settings.srcset[0] }}
    {% when "small" %}
      {{ site.data.responsives.settings.srcset[1] }}
    {% when "medium" %}
      {{ site.data.responsives.settings.srcset[3] }}      
  {% endcase %}
{% endcapture %}

{% if site.responsive_images %}

  {% capture srcset %}
    {% capture sizes %}
      {%- for size in site.data.responsives.settings.srcset -%}
        {{ site.paths.images | relative_url }}/{{ size | strip }}/{{ include.src | remove: 'assets/img/' | strip }} {{ size | strip }}w,
      {%- endfor -%}
    {% endcapture %}
    {{ sizes | split: ',' | join: ', ' }}
  {% endcapture %}

  {% capture sizes %}
    {% case include.size %}
    {% when "thumb" %}
      {{ site.data.responsives.settings.thumb | strip }}
    {% when "small" %}
      {{ site.data.responsives.settings.small | strip }}
    {% when "medium" %}
      {{ site.data.responsives.settings.medium | strip }}    
    {% endcase %}
  {% endcapture %}

{% endif %}

{% capture alt %}
  {% if include.alt %}
    {{ include.alt | strip_html | escape  }}
  {% elsif include.caption %}
    {{ include.caption | markdownify | strip_html | escape }}
  {% endif %}
{% endcapture %}

{% capture accessibility %}
  {% if include.src == default_image or include.src == author_image %} 
    role="presentation" aria-hidden="true"
  {% else %} 
    aria-labelledby="{{ include.src | strip }}"
  {% endif %}
{% endcapture %}


<figure class="img-{{ include.size | strip }} {{ include.class | strip }}" style="max-width:{{ width | strip }}px" {{ accessibility | strip }}>
  <img  {% if site.responsive_images %} 
        srcset="{{ srcset | strip }}"
        sizes="{{ sizes | strip }}" 
        {% endif %}
        src="{{ site.paths.images | relative_url }}/{%- if site.responsive_images -%}{{ width | strip }}/{%- endif -%}{{ include.src | remove: 'assets/img/' | strip }}" 
        alt="{{ alt | strip }}"
        width="{{ width | strip }}"
        loading="lazy">
  <figcaption id="{{ include.src | strip }}">
    <p>{{ include.caption | markdownify | strip_html | escape }}</p>
  </figcaption>
</figure>  

{% comment %} 
usage: {% include image.html src="filename.jpg" size="thumb/small/medium" alt="your alt text" caption="your caption" %}
{% endcomment %}
